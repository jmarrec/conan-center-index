From fdbca2277166d905e7dc55b0901473fab60cfc04 Mon Sep 17 00:00:00 2001
From: Julien Marrec <julien.marrec@gmail.com>
Date: Thu, 7 Jul 2022 09:25:33 +0200
Subject: [PATCH 2/2] cmakelist and win32 config.h

---
 CMakeLists.txt | 74 ++++++++++++++++++++++++++++++++++++++++++++++++++
 config.h       | 60 ++++++++++++++++++++++++++++++++++++++++
 2 files changed, 134 insertions(+)
 create mode 100644 CMakeLists.txt
 create mode 100644 config.h

diff --git a/CMakeLists.txt b/CMakeLists.txt
new file mode 100644
index 0000000..9a8d81a
--- /dev/null
+++ b/CMakeLists.txt
@@ -0,0 +1,74 @@
+cmake_minimum_required(VERSION 3.0)
+project(readline C)
+
+add_definitions(-DREADLINE_LIBRARY)
+add_definitions(-DHAVE_CONFIG_H)
+add_definitions(-D_CRT_SECURE_NO_WARNINGS)
+
+if(BUILD_SHARED_LIBS)
+    add_definitions(-DBUILD_READLINE_DLL)
+else()
+    add_definitions(-DREADLINE_STATIC)
+endif()
+
+include_directories(
+    ${CMAKE_CURRENT_SOURCE_DIR} # thats where the config.h is located
+)
+
+add_library(history
+  history.h
+  history.c
+  histexpand.c
+  histfile.c
+  histsearch.c
+  shell.c
+  mbutil.c
+  xfree.c
+  xmalloc.h
+  xmalloc.c
+)
+
+add_library(readline
+  readline.c
+  funmap.c
+  keymaps.c
+  vi_mode.c
+  parens.c
+  rltty.c
+  complete.c
+  bind.c
+  isearch.c
+  display.c
+  signals.c
+  util.c
+  kill.c
+  undo.c
+  macro.c
+  input.c
+  callback.c
+  terminal.c
+  xmalloc.c
+  history.c
+  histsearch.c
+  histexpand.c
+  histfile.c
+  nls.c
+  search.c
+  shell.c
+  savestring.c
+  tilde.c
+  text.c
+  misc.c
+  compat.c
+  mbutil.c
+  support/wcwidth.c)
+
+install(TARGETS readline
+    RUNTIME DESTINATION bin
+    LIBRARY DESTINATION lib
+    ARCHIVE DESTINATION lib)
+
+install(TARGETS history
+    RUNTIME DESTINATION bin
+    LIBRARY DESTINATION lib
+    ARCHIVE DESTINATION lib)
diff --git a/config.h b/config.h
new file mode 100644
index 0000000..339950d
--- /dev/null
+++ b/config.h
@@ -0,0 +1,60 @@
+#define RETSIGTYPE void
+#define VOID_SIGHANDLER 1
+#define PROTOTYPES 1
+#define HAVE_ISASCII 1
+#define HAVE_ISXDIGIT 1
+#define HAVE_MBRLEN 1
+#define HAVE_MBRTOWC 1
+#define HAVE_MBRTOWC 1
+#define HAVE_MBSRTOWCS 1
+#define HAVE_MEMMOVE 1
+#define HAVE_PUTENV 1
+#define HAVE_SETENV 1
+#define HAVE_SETLOCALE 1
+#define HAVE_STRCOLL 1
+#define STRCOLL_BROKEN 1
+#define HAVE_STRPBRK 1
+#define HAVE_TCGETATTR 1
+#define HAVE_VSNPRINTF 1
+#define HAVE_WCTOMB 1
+#define HAVE_WCWIDTH 1
+#define STDC_HEADERS 1
+#define HAVE_LANGINFO_H 1
+#define HAVE_LIMITS_H 1
+#define HAVE_LOCALE_H 1
+#define HAVE_MEMORY_H 1
+#define HAVE_STDARG_H 1
+#define HAVE_STDLIB_H 1
+#define HAVE_STRING_H 1
+#define HAVE_TERMIOS_H 1
+#define HAVE_WCHAR_H 1
+#define HAVE_WCTYPE_H 1
+#define HAVE_MBSTATE_T 1
+// #define HAVE_LANGINFO_CODESET
+#define VOID_SIGHANDLER 1
+#define STRUCT_WINSIZE_IN_SYS_IOCTL 1
+#define HAVE_GETPW_DECLS 1
+#define MUST_REINSTALL_SIGHANDLERS 1
+#define CTYPE_NON_ASCII 1
+
+#define ssize_t int
+
+/* Ultrix botches type-ahead when switching from canonical to
+   non-canonical mode, at least through version 4.3 */
+#if !defined(HAVE_TERMIOS_H) || !defined(HAVE_TCGETATTR) || defined(ultrix)
+#  define TERMIOS_MISSING
+#endif
+
+#if defined(STRCOLL_BROKEN)
+#  define HAVE_STRCOLL 1
+#endif
+
+#if (defined(__STDC__) || defined(_WIN32)) && defined(HAVE_STDARG_H)
+#  define PREFER_STDARG
+#  define USE_VARARGS
+#else
+#  if defined(HAVE_VARARGS_H)
+#    define PREFER_VARARGS
+#    define USE_VARARGS
+#  endif
+#endif
-- 
2.25.1

